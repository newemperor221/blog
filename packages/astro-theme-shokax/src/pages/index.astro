---
import Layout from '../layouts/Layout.astro'
import IndexContent from '../components/IndexContent.astro'
import { getCollection } from 'astro:content'

// Fetch all posts
const allPosts = await getCollection('posts')

// Sort posts by date, newest first, and filter out drafts
const posts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
---

<Layout>
  <IndexContent posts={posts} />
</Layout>
